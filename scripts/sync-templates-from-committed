#!/bin/bash
# Sync templates to match exactly what's in committed docs

set -e

echo "Syncing templates from committed docs..."

# Function to sync template with committed doc
sync_template() {
  local template_file="$1"
  local doc_file="$2"
  
  if [ ! -f "$template_file" ]; then
    echo "Warning: Template $template_file not found"
    return
  fi
  
  # Get committed version
  local committed_content
  committed_content=$(git show HEAD:"$doc_file" 2>/dev/null) || {
    echo "Warning: No committed version of $doc_file"
    return
  }
  
  # Write committed content to template
  echo "$committed_content" > "$template_file"
  echo "Synced: $template_file from $doc_file"
}

# Process all data source templates
for template in templates/data-sources/*.md.tmpl; do
  filename=$(basename "$template" .md.tmpl)
  doc_file="docs/data-sources/${filename}.md"
  sync_template "$template" "$doc_file"
done

# Process all resource templates
for template in templates/resources/*.md.tmpl; do
  filename=$(basename "$template" .md.tmpl)
  doc_file="docs/resources/${filename}.md"
  sync_template "$template" "$doc_file"
done

# Process index template
sync_template "templates/index.md.tmpl" "docs/index.md"

echo "Template sync complete."
