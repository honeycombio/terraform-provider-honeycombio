#!/bin/bash
# Normalize generated documentation files to avoid unnecessary diffs

set -e

DOCS_DIR="${1:-docs}"

if [ ! -d "$DOCS_DIR" ]; then
  echo "Error: Directory $DOCS_DIR does not exist"
  exit 1
fi

echo "Normalizing documentation files in $DOCS_DIR..."

# Find all markdown files and normalize them
find "$DOCS_DIR" -type f -name "*.md" | while read -r file; do
  # Remove trailing whitespace from each line
  sed -i '' 's/[[:space:]]*$//' "$file"
  
  # Ensure file ends with exactly one newline (no trailing blank lines)
  # This removes all trailing newlines and adds exactly one back
  # Using -0777 to read entire file, then replace trailing newlines with single newline
  perl -i -0777 -pe 's/\n+$/\n/s' "$file"
done

echo "Documentation files normalized."

