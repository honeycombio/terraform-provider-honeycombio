# Data Source: honeycombio_query_specification

Generates a [Query Specification](https://docs.honeycomb.io/api/query-specification/) in JSON format for use with resources that expect a JSON-formatted Query Specification like [`honeycombio_query`](../resources/query.md).

Using this data source to generate query specifications is optional.
It is also valid to use literal JSON strings in your configuration or to use the file interpolation function to read a raw JSON query specification from a file.

## Example Usage

```terraform
data "honeycombio_query_specification" "example" {
  # zero or more calculation blocks
  calculation {
    op     = "AVG"
    column = "duration_ms"
  }

  calculated_field {
    name       = "fast_enough"
    expression = "LTE($response.duration_ms, 200)"
  }

  filter {
    column = "trace.parent_id"
    op     = "does-not-exist"
  }

  filter {
    column = "app.tenant"
    op     = "="
    value  = "ThatSpecialTenant" 
  }

  filter {
    column = "fast_enough"
    op     = "="
    value  = false
  }

  filter_combination = "AND"

  breakdowns = ["app.tenant"]
    
  time_range = 28800 // in seconds, 8 hours
  
  compare_time_offset = 86400 // in seconds, compare with data from 1 day ago
}

output "json_query" {
    value = data.honeycombio_query_specification.example.json
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `breakdowns` (List of String) A list of fields to group results by.
- `calculated_field` (Block List) Zero or more configuration blocks describing the Calculated Fields to create for use in this query. (see [below for nested schema](#nestedblock--calculated_field))
- `calculation` (Block List) Zero or more configuration blocks describing the calculations to return as a time series and summary table. If no calculations are provided, "COUNT" is assumed. (see [below for nested schema](#nestedblock--calculation))
- `compare_time_offset` (Number) The time offset for comparison queries, in seconds. Used to compare current time range data with data from a previous time period.
- `end_time` (Number) The absolute end time of the query's time range, in seconds since the Unix epoch.
- `filter` (Block List) Zero or more configuration blocks describing the filters to apply to the query results. (see [below for nested schema](#nestedblock--filter))
- `filter_combination` (String) How to combine multiple filters. Defaults to "AND".
- `formula` (Block List) Zero or more configuration blocks describing formulas that compute values from calculations. (see [below for nested schema](#nestedblock--formula))
- `granularity` (Number) The time resolution of the query's graph, in seconds. Valid values must be in between the query's time range at maximum, and /1000 at minimum.
- `having` (Block List) Zero or more configuration blocks used to restrict returned groups in the query result. (see [below for nested schema](#nestedblock--having))
- `limit` (Number) The maximum number of results to return. Defaults to 1000.
- `order` (Block List) Zero or more configuration blocks describing how to order the query results. Each term must appear as a "calculation" or in "breakdowns". (see [below for nested schema](#nestedblock--order))
- `start_time` (Number) The absolute start time of the query's time range, in seconds since the Unix epoch.
- `time_range` (Number) The time range of the query, in seconds. Defaults to 7200.

### Read-Only

- `id` (String, Deprecated) The ID of the query specification.
- `json` (String) JSON representation of the query according to the [Query Specification](https://docs.honeycomb.io/api/query-specification/#fields-on-a-query-specification), can be used as input for other resources.

<a id="nestedblock--calculated_field"></a>
### Nested Schema for `calculated_field`

Required:

- `expression` (String) The formula to use for the Calculated Field. See the [Calculated Field Formula Reference](https://docs.honeycomb.io/reference/derived-column-formula/) for syntax and functions.
- `name` (String) The name of the Calculated Field.


<a id="nestedblock--calculation"></a>
### Nested Schema for `calculation`

Required:

- `op` (String) The operator to apply. See the supported list at [Calculation Operators](https://docs.honeycomb.io/api/query-specification/#calculation-operators).

Optional:

- `column` (String) The column to apply the operator on. Not allowed with "COUNT" or "CONCURRENCY", required for all other operators.
- `filter` (Block List) Zero or more configuration blocks describing filters to apply to this specific calculation. (see [below for nested schema](#nestedblock--calculation--filter))
- `filter_combination` (String) How to combine multiple calculation filters. Defaults to "AND".
- `name` (String) The name of the calculation. Required when using calculation filters or when referencing the calculation in a formula.

<a id="nestedblock--calculation--filter"></a>
### Nested Schema for `calculation.filter`

Required:

- `column` (String) The column to filter on.
- `op` (String) The operator to apply. See the supported list at [Filter Operators](https://docs.honeycomb.io/api/query-specification/#filter-operators). Not all operators require a value.

Optional:

- `value` (String) The value used for the filter. Not needed if op is "exists" or "does-not-exist".



<a id="nestedblock--filter"></a>
### Nested Schema for `filter`

Required:

- `column` (String) The column to filter on.
- `op` (String) The operator to apply. See the supported list at [Filter Operators](https://docs.honeycomb.io/api/query-specification/#filter-operators). Not all operators require a value.

Optional:

- `value` (String) The value used for the filter. Not needed if op is "exists" or "not-exists".


<a id="nestedblock--formula"></a>
### Nested Schema for `formula`

Required:

- `expression` (String) An expression that references calculations by name. Uses the same syntax as [Calculated Field expressions](https://docs.honeycomb.io/reference/derived-column-formula/), but references calculation names instead of column names.
- `name` (String) The name of the formula.


<a id="nestedblock--having"></a>
### Nested Schema for `having`

Required:

- `calculate_op` (String) The calculation operator to apply. Supports all [Calculation Operators](https://docs.honeycomb.io/api/query-specification/#calculation-operators) except `HEATMAP`.
- `op` (String) The operator to apply.
- `value` (Number) The value used for the filter.

Optional:

- `column` (String) The column to filter on. Not allowed with "COUNT".


<a id="nestedblock--order"></a>
### Nested Schema for `order`

Optional:

- `column` (String) Either a column present in "breakdown" or a column that "op" applies to.
- `op` (String) The calculation operator to apply. See the supported list at [Calculation Operators](https://docs.honeycomb.io/api/query-specification/#calculation-operators).
- `order` (String) The sort order to apply.

~> **NOTE** It is not allowed to specify all three of `time_range`, `start_time` and `end_time`. For more details about specifying time windows, check [Query specification: A caveat on time](https://docs.honeycomb.io/api/query-specification/#a-caveat-on-time).

-> **NOTE** Filter op `in` and `not-in` expect an array of strings as value. Use the `value` attribute and pass the values in a single string separated by `,` without additional spaces (similar to the query builder in the UI). For example: the list `foo`, `bar` becomes `foo,bar`.

~> **NOTE** A `having` block's `column`/`calculate_op` pair must have a corresponding `calculation`. There can be multiple `having` blocks for the same `column`/`calculate_op` pair.
